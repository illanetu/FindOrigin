# План реализации Telegram-бота FindOrigin

## Этап 1: Настройка базовой инфраструктуры проекта

1.1. Инициализация Next.js проекта
- Создать новый Next.js проект с TypeScript
- Настроить структуру папок (app или pages router)
- Установить необходимые зависимости

1.2. Настройка окружения
- Создать файл `.env.local` для хранения токена бота
- Добавить переменные окружения (BOT_TOKEN, и другие при необходимости)
- Настроить `.gitignore` для исключения секретных данных

1.3. Настройка деплоя на Vercel
- Подключить репозиторий к Vercel
- Настроить переменные окружения в Vercel
- Убедиться, что проект успешно деплоится

## Этап 2: Реализация базового webhook-обработчика

2.1. Создание API route для webhook
- Создать endpoint `/api/webhook` (POST)
- Реализовать базовую валидацию входящих запросов от Telegram
- Добавить проверку подлинности запросов (опционально, через secret token)

2.2. Обработка входящих сообщений
- Извлечь `chat.id` и `text` из `update.message`
- Обработать случай, когда пользователь отправляет ссылку на пост
- Реализовать базовую обработку ошибок

2.3. Отправка ответов через Telegram API
- Реализовать функцию отправки сообщений через Telegram Bot API
- Настроить быстрый ответ 200 OK (без долгих операций)
- Протестировать базовую функциональность отправки/получения сообщений

2.4. Настройка webhook в Telegram
- Зарегистрировать webhook URL в Telegram через Bot API
- Протестировать получение обновлений от Telegram

## Этап 3: Извлечение и обработка текста

3.1. Обработка ссылок на Telegram-посты
- Реализовать парсинг ссылок на Telegram-каналы/посты
- Извлечение текста из поста через Telegram API (если возможно)
- Обработка случаев, когда пост недоступен

3.2. Извлечение ключевых элементов из текста
- Реализовать выделение ключевых утверждений
- Извлечение дат (различные форматы)
- Извлечение чисел и статистических данных
- Извлечение имен собственных (люди, организации, места)
- Извлечение ссылок из текста

3.3. Обработка и нормализация данных
- Нормализация дат в единый формат
- Очистка и подготовка текста для дальнейшего анализа
- Создание структурированного представления извлеченных данных

## Этап 4: Поиск источников информации

4.1. Настройка поисковых механизмов
- Интеграция с поисковыми API (Google Search API, Bing Search API, или другие)
- Настройка параметров поиска для разных типов источников
- Реализация кэширования результатов поиска (опционально)

4.2. Поиск по категориям источников
- Поиск на официальных сайтах (правительственные, корпоративные)
- Поиск на новостных сайтах
- Поиск в блогах и аналитических ресурсах
- Поиск в научных исследованиях и публикациях

4.3. Фильтрация и ранжирование результатов
- Фильтрация результатов по релевантности
- Ранжирование источников по авторитетности
- Ограничение количества результатов (1-3 ссылки)

## Этап 5: Интеграция AI для сравнения смысла

5.1. Настройка AI-сервиса
- Выбор AI-сервиса (OpenAI GPT, Anthropic Claude, или другой)
- Настройка API ключей и подключения
- Создание промптов для сравнения смысла текстов

5.2. Реализация сравнения смысла
- Сравнение исходного текста с найденными источниками
- Использование AI для семантического анализа, а не буквального сравнения
- Оценка степени соответствия между текстом и источниками

5.3. Генерация оценки уверенности
- Создание системы оценки уверенности (например, процент или категории)
- Учет нескольких факторов: релевантность, авторитетность источника, степень соответствия
- Формирование итоговой оценки для каждого источника

## Этап 6: Формирование и отправка ответа пользователю

6.1. Форматирование результатов
- Создание структурированного ответа с найденными источниками
- Форматирование списка ссылок (1-3 ссылки)
- Добавление оценки уверенности для каждого источника

6.2. Отправка ответа пользователю
- Интеграция отправки форматированного ответа в webhook-обработчик
- Использование Markdown или HTML для красивого форматирования
- Обработка случаев, когда источники не найдены

6.3. Оптимизация производительности
- Убедиться, что основной ответ 200 OK отправляется быстро
- Выполнение долгих операций (поиск, AI-анализ) асинхронно
- Возможная реализация очереди задач для обработки запросов

## Этап 7: Тестирование и доработка

7.1. Функциональное тестирование
- Тестирование обработки текстовых сообщений
- Тестирование обработки ссылок на посты
- Тестирование различных типов контента (новости, факты, утверждения)

7.2. Тестирование поиска источников
- Проверка корректности извлечения ключевых элементов
- Тестирование поиска по разным категориям источников
- Проверка качества результатов поиска

7.3. Тестирование AI-анализа
- Проверка точности сравнения смысла
- Тестирование оценки уверенности
- Валидация результатов на различных примерах

7.4. Оптимизация и улучшения
- Оптимизация производительности
- Улучшение точности извлечения данных
- Улучшение качества поиска и ранжирования
- Обработка edge cases и ошибок

## Этап 8: Документация и финализация

8.1. Документация
- Написание README с инструкциями по установке и настройке
- Документация API endpoints
- Описание процесса деплоя

8.2. Финальная проверка
- Проверка работы на production (Vercel)
- Тестирование webhook в реальных условиях
- Финальная оптимизация и исправление багов
